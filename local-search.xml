<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>经济学十大原理</title>
    <link href="/2021/04/20/%E7%BB%8F%E6%B5%8E%E5%AD%A6%E5%8D%81%E5%A4%A7%E5%8E%9F%E7%90%86/"/>
    <url>/2021/04/20/%E7%BB%8F%E6%B5%8E%E5%AD%A6%E5%8D%81%E5%A4%A7%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h5 id="个人要做决策的时候需要考虑的事情"><a href="#个人要做决策的时候需要考虑的事情" class="headerlink" title="个人要做决策的时候需要考虑的事情"></a>个人要做决策的时候需要考虑的事情</h5><ol><li><p>people face tradeoffs.<br>人们面临得失交换。</p></li><li><p>the cost of something is what you give up to get it.<br>某物的成本是为此所放弃的东西。</p></li><li><p>rational people think at the margin.<br>理性的人考虑边际量。</p></li><li><p>people resond to incentives.<br>人们会对激励作出反应。</p></li></ol><h5 id="人们如何相互作用的"><a href="#人们如何相互作用的" class="headerlink" title="人们如何相互作用的"></a>人们如何相互作用的</h5><ol start="5"><li><p>trade can make everyone better off.<br>贸易能使人人受益。</p></li><li><p>markets are usually a good way to organize economic activity.<br>市场通常是组织经济活动的好方式。</p></li><li><p>government can sometimes improve market outcomes.<br>政府有时可以改进市场结果。</p></li><li><p>the standard of living depends on a country*s production.<br>一国的生活水平取决于它的生产。</p></li><li><p>prices rise when the government prints too much money.<br>当政府发行了过多的货币时，物价上涨。</p></li><li><p>society faces a short-run tradeoff between inflation and unemployment.<br>  社会面临通货膨胀和失业之间的短期得失交换。</p></li></ol>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>日志收集框架EFK</title>
    <link href="/2020/12/14/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E6%A1%86%E6%9E%B6EFK/"/>
    <url>/2020/12/14/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E6%A1%86%E6%9E%B6EFK/</url>
    
    <content type="html"><![CDATA[<p>主要涉及 Elasticsearch、Kibana和Filebeat。为了系统兼容性，框架使用统一的版本，目前使用的版本是7.6.1。</p><h2 id="一、Elasticsearch"><a href="#一、Elasticsearch" class="headerlink" title="一、Elasticsearch"></a>一、Elasticsearch</h2><h3 id="1-Elasticsearch-安装"><a href="#1-Elasticsearch-安装" class="headerlink" title="1.Elasticsearch 安装"></a>1.Elasticsearch 安装</h3><ul><li>访问 Elastic 官网下载页面 <a href="https://www.elastic.co/cn/downloads/elasticsearch，下载对应安装包，再上传到服务器上安装。">https://www.elastic.co/cn/downloads/elasticsearch，下载对应安装包，再上传到服务器上安装。</a></li></ul><ul><li>使用 wget 命令下载（注意修改版本号）：</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 进入软件安装目录</span><br><span class="hljs-built_in">cd</span> /vdb1/software/<br><br><span class="hljs-comment"># 下载 Elasticsearch，或者本地下载完再上传到服务器</span><br>wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.6.1-linux-x86_64.tar.gz<br><br><span class="hljs-comment"># 创建 elasticsearch 目录</span><br>mkdir elasticsearch<br><br><span class="hljs-comment"># 解压 Elasticsearch 到 elasticsearch 目录并进入</span><br>tar -zxvf elasticsearch-7.6.1-linux-x86_64.tar.gz<br><span class="hljs-built_in">cd</span> elasticsearch<br><br><span class="hljs-comment"># 创建数据目录</span><br>mkdir data<br></code></pre></td></tr></table></figure><p>Elasticsearch 不需要编译，运行 bin 目录下的 elasticsearch 即可启动服务。这里暂不启动，等下面配置完成后再启动。</p><h3 id="2-Elasticsearch-配置"><a href="#2-Elasticsearch-配置" class="headerlink" title="2.Elasticsearch 配置"></a>2.Elasticsearch 配置</h3><p>Elasticsearch 配置文件都在 config 目录下，主要有 elasticsearch.yml（ES配置）、jvm.options（JVM配置）、log4j2.properties（日志配置）。</p><h4 id="elasticsearch-yml"><a href="#elasticsearch-yml" class="headerlink" title="elasticsearch.yml"></a>elasticsearch.yml</h4><p>备份配置文件为 elasticsearch.default.yml，修改 elasticsearch.yml，主要修改以下配置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 节点配置</span><br><span class="hljs-attr">node.name:</span> <span class="hljs-string">node-1</span><br><span class="hljs-attr">node.attr.rack:</span> <span class="hljs-string">r1</span><br><br><span class="hljs-comment"># Elasticsearch 数据目录和日志目录</span><br><span class="hljs-attr">path.data:</span> <span class="hljs-string">/vdb1/software/elasticsearch/data</span><br><span class="hljs-attr">path.logs:</span> <span class="hljs-string">/vdb1/software/elasticsearch/elasticsearch-7.6.1/logs</span><br><br><span class="hljs-comment"># 网络</span><br><span class="hljs-attr">network.host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br><span class="hljs-attr">http.port:</span> <span class="hljs-number">9200</span><br><br><span class="hljs-comment"># 集群-发现</span><br><span class="hljs-attr">cluster.initial_master_nodes:</span> [<span class="hljs-string">&quot;node-1&quot;</span>]<br><br><span class="hljs-comment"># 安全认证</span><br><span class="hljs-attr">xpack.security.enabled:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">xpack.security.transport.ssl.enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>ES中内置了几个管理其他集成组件的账号即：<code>elastic</code>， <code>apm_system</code>，<code>kibana</code>，<code>logstash_system</code>，<code>beats_system</code>，<code>remote_monitoring_user</code><br> 在使用前需要先设置密码：<br> 在 Elasticsearch 安装目录下执行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 创建keystore</span><br>./bin/elasticsearch-keystore create<br><br><span class="hljs-comment"># 重置密码</span><br>./bin/elasticsearch-setup-passwords interactive<br></code></pre></td></tr></table></figure><p>这里密码统一设置成：<code>123456</code>。</p><h4 id="jvm-options"><a href="#jvm-options" class="headerlink" title="jvm.options"></a>jvm.options</h4><p>修改 jvm.options 文件，主要修改堆内存大小：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 默认</span><br><span class="hljs-string">-Xms1g</span><br><span class="hljs-string">-Xmx1g</span><br><br><span class="hljs-comment"># 修改后</span><br><span class="hljs-string">-Xms4g</span><br><span class="hljs-string">-Xmx4g</span><br></code></pre></td></tr></table></figure><p>官网建议：</p><ul><li><p>把 50％ 的可用内存作为 Elasticsearch 的堆内存，保留剩下的 50％。当然它也不会被浪费，Lucene 会很乐意利用起余下的内存。</p></li><li><p>最大不要超过32GB</p></li></ul><p>具体理由来源于官网指导文档：</p><p><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/heap-sizing.html">https://www.elastic.co/guide/cn/elasticsearch/guide/current/heap-sizing.html</a></p><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/heap-size.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/heap-size.html</a></p><h4 id="log4j2-properties"><a href="#log4j2-properties" class="headerlink" title="log4j2.properties"></a>log4j2.properties</h4><p>日志配置这里暂不修改。</p><h3 id="3-Elasticsearch-启动管理"><a href="#3-Elasticsearch-启动管理" class="headerlink" title="3.Elasticsearch 启动管理"></a>3.Elasticsearch 启动管理</h3><p>Elasticsearch 命令说明</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 启动</span><br>./elasticsearch<br><br><span class="hljs-comment"># 后台启动</span><br>./elasticsearch -d<br><br><span class="hljs-comment"># 重启或者停止，查询PID，再kill</span><br>ps -ef | grep elasticsearch<br><span class="hljs-built_in">kill</span> pid<br><br><span class="hljs-comment"># 服务自动启动</span><br><br></code></pre></td></tr></table></figure><p>Elasticsearch 脚本 elasticsearch.sh</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;-------- Elasticsearch 管理脚本 --------&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; 1.启动 Elasticsearch&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; 2.停止 Elasticsearch&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; 3.重启 Elasticsearch&quot;</span><br><span class="hljs-built_in">read</span> -t 30 -p <span class="hljs-string">&quot;请选择数字[1~3]：&quot;</span> num<br><br><span class="hljs-comment"># 配置 elasticsearch</span><br><span class="hljs-built_in">exec</span>=<span class="hljs-string">&quot;/vdb1/software/elasticsearch/elasticsearch-7.6.1/bin/elasticsearch&quot;</span><br><br><span class="hljs-comment"># 启动</span><br><span class="hljs-function"><span class="hljs-title">start</span></span>() &#123;<br>`<span class="hljs-variable">$&#123;exec&#125;</span> -d`<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;elasticsearch start&quot;</span><br>&#125;<br><br><span class="hljs-comment"># 停止</span><br><span class="hljs-function"><span class="hljs-title">stop</span></span>() &#123;<br>es_pid=`ps aux|egrep <span class="hljs-string">&#x27;[e]lasticsearch&#x27;</span> | grep -v <span class="hljs-string">&#x27;elasticsearch.sh&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>`<br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;&quot;</span> == <span class="hljs-string">&quot;<span class="hljs-variable">$es_pid</span>&quot;</span> ]<br><span class="hljs-keyword">then</span><br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;elasticsearch not run&quot;</span><br><span class="hljs-keyword">else</span><br><span class="hljs-built_in">kill</span> -9 <span class="hljs-variable">$es_pid</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;elasticsearch stop&quot;</span><br><span class="hljs-keyword">fi</span><br>&#125;<br><br><span class="hljs-comment"># 重启</span><br><span class="hljs-function"><span class="hljs-title">restart</span></span>() &#123;<br>stop<br>start<br>&#125;<br><br><span class="hljs-keyword">case</span> <span class="hljs-variable">$num</span> <span class="hljs-keyword">in</span><br>1)<br>start<br>;;<br>2)<br>stop<br>;;<br>3)<br>restart<br>;;<br>*)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;数字无效&quot;</span><br>;;<br><span class="hljs-keyword">esac</span><br><br><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure><h3 id="4-Elasticsearch-问题"><a href="#4-Elasticsearch-问题" class="headerlink" title="4.Elasticsearch 问题"></a>4.Elasticsearch 问题</h3><p>部署 Elasticsearch 可能遇到的问题，我自己部署时遇到第3个问题，按照解决方法修改配置解决。</p><h4 id="1）启动报错"><a href="#1）启动报错" class="headerlink" title="1）启动报错"></a>1）启动报错</h4><blockquote><p>max file descriptors [4096] for elasticsearch process is too low, increase to at least [65536]</p></blockquote><p>每个进程最大同时打开文件数太小，可通过下面2个命令查看当前数量</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">ulimit</span> -Hn<br><span class="hljs-built_in">ulimit</span> -Sn<br></code></pre></td></tr></table></figure><p>修改 /etc/security/limits.conf 文件，增加配置，用户退出后重新登录生效</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs conf">*               soft    nofile          65536<br>*               hard    nofile          65536<br></code></pre></td></tr></table></figure><h4 id="2）启动报错"><a href="#2）启动报错" class="headerlink" title="2）启动报错"></a>2）启动报错</h4><blockquote><p>max number of threads [3818] for user [es] is too low, increase to at least [4096]</p></blockquote><p>问题同上，最大线程个数太低。修改配置文件/etc/security/limits.conf（和问题1是一个文件），增加配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs conf">*               soft    nproc           4096<br>*               hard    nproc           4096<br></code></pre></td></tr></table></figure><p>可通过命令查看</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">ulimit</span> -Hu<br><span class="hljs-built_in">ulimit</span> -Su<br></code></pre></td></tr></table></figure><h4 id="3）启动报错"><a href="#3）启动报错" class="headerlink" title="3）启动报错"></a>3）启动报错</h4><blockquote><p>max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</p></blockquote><p>修改 /etc/sysctl.conf 文件，增加配置 vm.max_map_count = 262144</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/sysctl.conf<br>sysctl -p<br></code></pre></td></tr></table></figure><p>执行命令 sysctl -p 生效</p><h4 id="4）启动报错"><a href="#4）启动报错" class="headerlink" title="4）启动报错"></a>4）启动报错</h4><blockquote><p>Exception in thread “main” java.nio.file.AccessDeniedException: /home/jason/elasticsearch/elasticsearch-7.6.1/config/jvm.options</p></blockquote><p>elasticsearch 用户没有该文件夹的权限，执行命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">chown -R es:es /usr/<span class="hljs-built_in">local</span>/elasticsearch/<br></code></pre></td></tr></table></figure><h4 id="5）启动-Elasticsearch-报错"><a href="#5）启动-Elasticsearch-报错" class="headerlink" title="5）启动 Elasticsearch 报错"></a>5）启动 Elasticsearch 报错</h4><blockquote><p>ERROR: [1] bootstrap checks failed [1]: the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery. seed_providers, cluster.initial_master_nodes] must be configured</p></blockquote><p>这个是配置问题，修改 elasticsearch.yml，取消注释保留一个节点：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">cluster.initial_master_nodes:</span> [<span class="hljs-string">&quot;node-1&quot;</span>]<br></code></pre></td></tr></table></figure><p>这个的话，这里的 node-1 是上面一个默认的记得打开就可以了。</p><h2 id="二、Kibana"><a href="#二、Kibana" class="headerlink" title="二、Kibana"></a>二、Kibana</h2><h3 id="1-Kibana-安装"><a href="#1-Kibana-安装" class="headerlink" title="1.Kibana 安装"></a>1.Kibana 安装</h3><p>访问 Elastic 官网下载页面 <a href="https://www.elastic.co/cn/downloads/kibana，下载对应安装包，再上传到服务器上安装。">https://www.elastic.co/cn/downloads/kibana，下载对应安装包，再上传到服务器上安装。</a></p><p>或者使用 wget 命令下载（注意修改版本号）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 进入软件安装目录</span><br><span class="hljs-built_in">cd</span> /vdb1/software/<br><br><span class="hljs-comment"># 下载 Kibana，或者本地下载完再上传到服务器</span><br>wget https://artifacts.elastic.co/downloads/kibana/kibana-7.6.1-linux-x86_64.tar.gz<br><br><span class="hljs-comment"># 创建 kibana 目录</span><br>mkdir kibana<br><br><span class="hljs-comment"># 解压 Kibana 到 kibana 目录并进入</span><br>tar -zxvf kibana-7.6.1-linux-x86_64.tar.gz<br><span class="hljs-built_in">cd</span> kibana<br><br><span class="hljs-comment"># 创建日志目录</span><br>mkdir logs<br></code></pre></td></tr></table></figure><p>Kibana 不需要编译，进入 bin 目录运行 kibana 就可以启动。这里暂不启动，等下面配置完成后再启动。</p><h3 id="2-Kibana-配置"><a href="#2-Kibana-配置" class="headerlink" title="2.Kibana 配置"></a>2.Kibana 配置</h3><p>Kibana 配置文件在 config 目录下，主要是 kibana.yml 文件。</p><h4 id="kibana-yml"><a href="#kibana-yml" class="headerlink" title="kibana.yml"></a>kibana.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Kibana 基础配置</span><br><span class="hljs-attr">server.port:</span> <span class="hljs-number">5601</span><br><span class="hljs-attr">server.host:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><br><br><span class="hljs-comment"># Elasticsearch 配置</span><br><span class="hljs-attr">elasticsearch.hosts:</span> [<span class="hljs-string">&quot;http://127.0.0.1:9200&quot;</span>]<br><span class="hljs-attr">elasticsearch.username:</span> <span class="hljs-string">&quot;kibana&quot;</span><br><span class="hljs-attr">elasticsearch.password:</span> <span class="hljs-string">&quot;zkuser&quot;</span><br><br><span class="hljs-comment"># Kibana 日志</span><br><span class="hljs-attr">logging.dest:</span> <span class="hljs-string">/vdb1/software/kibana/logs/kibana.log</span><br><span class="hljs-comment"># 日志循环（7.6.1版本为实验性）</span><br><span class="hljs-attr">logging.rotate:</span><br>  <span class="hljs-comment"># 启用日志循环，logging.dest 为 stdout 无效</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># 日志文件最大限制，1048576 (1 MB) to 1073741824 (1 GB).</span><br>  <span class="hljs-attr">everyBytes:</span> <span class="hljs-number">10485760</span><br>  <span class="hljs-comment"># 日志文件保留数量，超出会删除旧的，2 ~ 1024个，默认 7</span><br>  <span class="hljs-attr">keepFiles:</span> <span class="hljs-number">10</span><br><br><span class="hljs-comment"># Kibana 语言设置，默认 en，中文为 zh-CN</span><br><span class="hljs-attr">i18n.locale:</span> <span class="hljs-string">&quot;zh-CN&quot;</span><br><br></code></pre></td></tr></table></figure><p>关于配置文件详情请看官方文档说明，地址：<a href="https://www.elastic.co/guide/en/kibana/current/settings.html">https://www.elastic.co/guide/en/kibana/current/settings.html</a></p><h3 id="3-Kibana-启动管理"><a href="#3-Kibana-启动管理" class="headerlink" title="3.Kibana 启动管理"></a>3.Kibana 启动管理</h3><p>Kibana 命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 启动</span><br>./kibana<br><br><span class="hljs-comment"># 后台启动</span><br>nohup ./kibana &gt; /dev/null 2&gt;&amp;1 &amp;<br><br><span class="hljs-comment"># 服务自动启动</span><br><br></code></pre></td></tr></table></figure><p>Kibana 脚本 kibana.sh</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;-------- Kibana 管理脚本 --------&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; 1.启动 Kibana&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; 2.停止 Kibana&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; 3.重启 Kibana&quot;</span><br><span class="hljs-built_in">read</span> -t 30 -p <span class="hljs-string">&quot;请选择数字[1~3]：&quot;</span> num<br><br><br><span class="hljs-comment"># 配置 kibana</span><br><span class="hljs-built_in">exec</span>=<span class="hljs-string">&quot;/vdb1/software/kibana/kibana-7.6.1-linux-x86_64/bin/kibana&quot;</span><br><br><span class="hljs-comment"># 启动</span><br><span class="hljs-function"><span class="hljs-title">start</span></span>() &#123;<br>out=`nohup <span class="hljs-variable">$&#123;exec&#125;</span> &gt; /dev/null 2&gt;&amp;1 &amp;`<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;kibana start&quot;</span><br>&#125;<br><br><span class="hljs-comment"># 停止</span><br><span class="hljs-function"><span class="hljs-title">stop</span></span>() &#123;<br><span class="hljs-comment"># pid=`ps aux|grep kibana | grep -v &#x27;grep kibana&#x27; | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="hljs-comment"># 使用 lsof 查看端口，确定 kibana 进程的 PID</span><br>pid=`lsof -i:5601 | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>`<br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;&quot;</span> == <span class="hljs-string">&quot;<span class="hljs-variable">$pid</span>&quot;</span> ]<br><span class="hljs-keyword">then</span><br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;kibana not run&quot;</span><br><span class="hljs-keyword">else</span><br><span class="hljs-built_in">kill</span> -9 <span class="hljs-variable">$pid</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;kibana stop&quot;</span><br><span class="hljs-keyword">fi</span><br>&#125;<br><br><span class="hljs-comment"># 重启</span><br><span class="hljs-function"><span class="hljs-title">restart</span></span>() &#123;<br>stop<br>start<br>&#125;<br><br><span class="hljs-keyword">case</span> <span class="hljs-variable">$num</span> <span class="hljs-keyword">in</span><br>1)<br>start<br>;;<br>2)<br>stop<br>;;<br>3)<br>restart<br>;;<br>*)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;数字无效&quot;</span><br>;;<br><span class="hljs-keyword">esac</span><br><br><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure><h2 id="三、Filebeat"><a href="#三、Filebeat" class="headerlink" title="三、Filebeat"></a>三、Filebeat</h2><h3 id="1-Filebeat-安装"><a href="#1-Filebeat-安装" class="headerlink" title="1.Filebeat 安装"></a>1.Filebeat 安装</h3><p>访问 Elastic 官网下载页面 <a href="https://www.elastic.co/cn/downloads/beats/filebeat，下载对应安装包，再上传到服务器上安装。">https://www.elastic.co/cn/downloads/beats/filebeat，下载对应安装包，再上传到服务器上安装。</a></p><p>或者使用 wget 命令下载（注意修改版本号）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 进入软件安装目录</span><br><span class="hljs-built_in">cd</span> /vdb1/software/<br><br><span class="hljs-comment"># 下载 Filebeat，或者本地下载完再上传到服务器</span><br>wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.6.1-linux-x86_64.tar.gz<br><br><span class="hljs-comment"># 创建 filebeat 目录</span><br>mkdir filebeat<br><br><span class="hljs-comment"># 解压 Filebeat 到 filebeat 目录并进入</span><br>tar -xzvf filebeat-7.6.1-linux-x86_64.tar.gz<br><span class="hljs-built_in">cd</span> filebeat<br><br><span class="hljs-comment"># 创建日志目录</span><br>mkdir logs<br></code></pre></td></tr></table></figure><p>Filebeat 不需要编译，进入目录运行 filebeat 就可以启动。</p><h3 id="2-Filebeat-配置"><a href="#2-Filebeat-配置" class="headerlink" title="2.Filebeat 配置"></a>2.Filebeat 配置</h3><p>Filebeat 的配置文件在根目录下，主要配置有 filebeat.yml（Filebeat配置）、filebeat.reference.yml（完整示例配置文件）、fields.yml（模板文件）以及 modules.d 目录下的各个模块配置。</p><h4 id="filebeat-yml"><a href="#filebeat-yml" class="headerlink" title="filebeat.yml"></a>filebeat.yml</h4><p>filebeat.yml 主要修改以下配置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#=========================== Filebeat inputs =============================</span><br><br><span class="hljs-attr">filebeat.inputs:</span><br><br><span class="hljs-comment"># info 日志</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">log</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">paths:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">/vdb1/platform-logs/*/logs/info.log</span><br>  <span class="hljs-attr">fields:</span><br>    <span class="hljs-attr">source:</span> <span class="hljs-string">info</span><br>  <span class="hljs-attr">multiline.pattern:</span> <span class="hljs-string">&#x27;^(\[)?\d&#123;4&#125;(\-|\/|\.)\d&#123;1,2&#125;(\-|\/|\.)\d&#123;1,2&#125;|((2[0-4]\d|25[0-5]|[01]?\d\d?)\.)&#123;3&#125;(2[0-4]\d|25[0-5]|[01]?\d\d?)&#x27;</span><br>  <span class="hljs-attr">multiline.negate:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">multiline.match:</span> <span class="hljs-string">after</span><br>  <span class="hljs-comment"># 设置不收集日志文件，支持路径</span><br>  <span class="hljs-attr">exclude_files:</span> [<span class="hljs-string">&#x27;/vdb1/platform-logs/gateway-master/logs/info.log$&#x27;</span>]<br><br><span class="hljs-comment"># error 日志</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">log</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">paths:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">/vdb1/platform-logs/*/logs/error.log</span><br>  <span class="hljs-attr">fields:</span><br>    <span class="hljs-attr">source:</span> <span class="hljs-string">error</span><br>  <span class="hljs-attr">multiline.pattern:</span> <span class="hljs-string">&#x27;^(\[)?\d&#123;4&#125;(\-|\/|\.)\d&#123;1,2&#125;(\-|\/|\.)\d&#123;1,2&#125;|((2[0-4]\d|25[0-5]|[01]?\d\d?)\.)&#123;3&#125;(2[0-4]\d|25[0-5]|[01]?\d\d?)&#x27;</span><br>  <span class="hljs-attr">multiline.negate:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">multiline.match:</span> <span class="hljs-string">after</span><br>  <span class="hljs-comment"># 设置不收集日志文件，支持路径</span><br>  <span class="hljs-attr">exclude_files:</span> [<span class="hljs-string">&#x27;/vdb1/platform-logs/gateway-master/logs/error.log$&#x27;</span>]<br><br><span class="hljs-comment">#============================= Filebeat modules ===============================</span><br><br><span class="hljs-attr">filebeat.config.modules:</span><br>  <span class="hljs-attr">path:</span> <span class="hljs-string">$&#123;path.config&#125;/modules.d/*.yml</span><br>  <span class="hljs-attr">reload.enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">reload.period:</span> <span class="hljs-string">10s</span><br><br><span class="hljs-comment">#==================== Elasticsearch template setting ==========================</span><br><br><span class="hljs-attr">setup.template.settings:</span><br>  <span class="hljs-attr">index.number_of_shards:</span> <span class="hljs-number">1</span><br><br><span class="hljs-attr">setup.template.enabled:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">setup.template.name:</span> <span class="hljs-string">&quot;aimdt&quot;</span><br><span class="hljs-attr">setup.template.pattern:</span> <span class="hljs-string">&quot;aimdt-*&quot;</span><br><span class="hljs-attr">setup.template.overwrite:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-attr">setup.ilm.enabled:</span> <span class="hljs-literal">false</span><br><span class="hljs-comment">#setup.ilm.rollover_alias: &quot;aimdt&quot;</span><br><span class="hljs-comment">#setup.ilm.pattern: &quot;&#123;now/d&#125;-000001&quot;</span><br><span class="hljs-comment">#setup.ilm.policy_name: &quot;aimdt&quot;</span><br><br><span class="hljs-comment">#============================== Dashboards =====================================</span><br><br><span class="hljs-attr">setup.dashboards.enabled:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment">#============================== Kibana =====================================</span><br><br><span class="hljs-attr">setup.kibana:</span><br>  <span class="hljs-attr">host:</span> <span class="hljs-string">&quot;127.0.0.1:5601&quot;</span><br><br><span class="hljs-comment">#-------------------------- Elasticsearch output ------------------------------</span><br><span class="hljs-attr">output.elasticsearch:</span><br>  <span class="hljs-attr">hosts:</span> [<span class="hljs-string">&quot;127.0.0.1:9200&quot;</span>]<br><br>  <span class="hljs-attr">username:</span> <span class="hljs-string">&quot;elastic&quot;</span><br>  <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;zkuser&quot;</span><br><br>  <span class="hljs-attr">indices:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">index:</span> <span class="hljs-string">&quot;&lt;info-&#123;now/d&#125;&gt;&quot;</span><br>      <span class="hljs-attr">when.equals:</span><br>        <span class="hljs-attr">fields:</span><br>          <span class="hljs-attr">source:</span> <span class="hljs-string">&quot;info&quot;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">index:</span> <span class="hljs-string">&quot;&lt;error-&#123;now/d&#125;&gt;&quot;</span><br>      <span class="hljs-attr">when.equals:</span><br>        <span class="hljs-attr">fields:</span><br>          <span class="hljs-attr">source:</span> <span class="hljs-string">&quot;error&quot;</span><br><br><span class="hljs-comment">#================================ Logging =====================================</span><br><br><span class="hljs-attr">logging.level:</span> <span class="hljs-string">info</span><br><span class="hljs-attr">logging.selectors:</span> [<span class="hljs-string">&quot;*&quot;</span>]<br><br><span class="hljs-attr">logging.to_syslog:</span> <span class="hljs-literal">false</span><br><span class="hljs-attr">logging.to_files:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">logging.files:</span><br>  <span class="hljs-attr">path:</span> <span class="hljs-string">/vdb1/software/filebeat/logs/</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">filebeat.log</span><br>  <span class="hljs-comment">#rotateeverybytes: 10M</span><br>  <span class="hljs-attr">keepfiles:</span> <span class="hljs-number">10</span><br></code></pre></td></tr></table></figure><h3 id="3-Filebeat-启动管理"><a href="#3-Filebeat-启动管理" class="headerlink" title="3.Filebeat 启动管理"></a>3.Filebeat 启动管理</h3><p>Filebeat 命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 设置 dashboard（也可以通过配置文件配置）</span><br>./filebeat setup --dashboards<br><br><span class="hljs-comment"># 启动 Filebeat （-e 不输出日志 -c 配置文件 -d 过滤日志）</span><br><span class="hljs-comment"># 如果配置了输出日志，则不能添加 -e</span><br>./filebeat -e -c filebeat.yml -d <span class="hljs-string">&quot;publish&quot;</span><br><br><span class="hljs-comment"># 后台启动</span><br>nohup ./filebeat -c filebeat.yml &gt; /dev/null 2&gt;&amp;1 &amp;<br><br><span class="hljs-comment"># 服务自启动</span><br><br></code></pre></td></tr></table></figure><p>Filebeat 脚本 filebeat.sh</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;-------- Filebeat 管理脚本 --------&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; 1.启动 Filebeat&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; 2.停止 Filebeat&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; 3.重启 Filebeat&quot;</span><br><span class="hljs-built_in">read</span> -t 30 -p <span class="hljs-string">&quot;请选择数字[1~3]：&quot;</span> num<br><br><span class="hljs-comment"># 配置 Filebeat 启动文件的路径</span><br><span class="hljs-built_in">exec</span>=<span class="hljs-string">&quot;/vdb1/software/filebeat/filebeat-7.6.1-linux-x86_64/filebeat&quot;</span><br>conf=<span class="hljs-string">&quot;/vdb1/software/filebeat/filebeat-7.6.1-linux-x86_64/filebeat.yml&quot;</span><br><br><span class="hljs-comment"># 启动</span><br><span class="hljs-function"><span class="hljs-title">start</span></span>() &#123;<br>out=`nohup <span class="hljs-variable">$&#123;exec&#125;</span> -c <span class="hljs-variable">$&#123;conf&#125;</span> &gt; /dev/null 2&gt;&amp;1 &amp;`<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;filebeat start&quot;</span><br>&#125;<br><br><span class="hljs-comment"># 停止</span><br><span class="hljs-function"><span class="hljs-title">stop</span></span>() &#123;<br>pid=`ps aux | egrep <span class="hljs-string">&#x27;[f]ilebeat&#x27;</span> | grep -v <span class="hljs-string">&#x27;filebeat.sh&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>`<br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;&quot;</span> == <span class="hljs-string">&quot;<span class="hljs-variable">$pid</span>&quot;</span> ]<br><span class="hljs-keyword">then</span><br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;filebeat not run&quot;</span><br><span class="hljs-keyword">else</span><br><span class="hljs-built_in">kill</span> -9 <span class="hljs-variable">$pid</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;filebeat stop&quot;</span><br><span class="hljs-keyword">fi</span><br>&#125;<br><br><span class="hljs-comment"># 重启</span><br><span class="hljs-function"><span class="hljs-title">restart</span></span>() &#123;<br>stop<br>start<br>&#125;<br><br><span class="hljs-keyword">case</span> <span class="hljs-variable">$num</span> <span class="hljs-keyword">in</span><br>1)<br>start<br>;;<br>2)<br>stop<br>;;<br>3)<br>restart<br>;;<br>*)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;数字无效&quot;</span><br>;;<br><span class="hljs-keyword">esac</span><br><br><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>有效的微服务：10 个最佳实践</title>
    <link href="/2020/01/14/%E6%9C%89%E6%95%88%E7%9A%84%E5%BE%AE%E6%9C%8D%E5%8A%A1%EF%BC%9A10%20%E4%B8%AA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/"/>
    <url>/2020/01/14/%E6%9C%89%E6%95%88%E7%9A%84%E5%BE%AE%E6%9C%8D%E5%8A%A1%EF%BC%9A10%20%E4%B8%AA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/</url>
    
    <content type="html"><![CDATA[<p>转载自：</p><p><a href="https://mp.weixin.qq.com/s?__biz=MzA4Nzc4MjI4MQ==&amp;mid=2652403392&amp;idx=1&amp;sn=9c0d6115dce1264222841e36317f2a0d">https://mp.weixin.qq.com/s?__biz=MzA4Nzc4MjI4MQ==&amp;mid=2652403392&amp;idx=1&amp;sn=9c0d6115dce1264222841e36317f2a0d</a></p><h2 id="1-领域驱动设计"><a href="#1-领域驱动设计" class="headerlink" title="1. 领域驱动设计"></a>1. 领域驱动设计</h2><p>微服务开发的首要挑战：</p><p>把大的、复杂的应用拆分为小的、自治的、可独立部署的模块。</p><p>如果没有正确的拆分，那么结果就是一堆浆糊，有着单体结构的缺点，和微服务结构的复杂度，可以称之为<strong>分布式单体</strong>。</p><p>幸运的是，Eric Evans 为领域驱动设计提出了大量的最佳实践和经验技巧，有3个核心思维：</p><ul><li>开发团队要和业务部门、业务领域专家紧密合作。</li><li>架构师、开发人员、领域专家应该先做出战略设计：找出边界上下文、核心域、子域、上下文映射关系。</li><li>架构师、开发人员根据战略设计梳理出一套核心构造块：实体、值对象、聚合等等。</li></ul><p>把一个大型系统划分为核心域、子域，再把核心域、子域映射为微服务，这样我们就可以得到一个理想的松耦合微服务体系。</p><h2 id="2-每个微服务一个数据库"><a href="#2-每个微服务一个数据库" class="headerlink" title="2. 每个微服务一个数据库"></a>2. 每个微服务一个数据库</h2><p>微服务模块结构设计好了，下面一个重要问题就是怎么处理数据库，各个微服务是否共享数据库呢？</p><p>如果共享，将导致微服务之间紧耦合，违背了微服务的松耦合原则。数据库中一个小小的变动就需要各个团队同步修改。</p><p>如果每个微服务都有自己的数据库，那么微服务之间的数据交换将非常麻烦，就像打开了潘多拉魔盒，跑出一堆问题，例如在多个服务中管理事务。</p><p>所以，很多人主张共享数据库。</p><p>但是，微服务是持续的、长期的软件开发，每个微服务应该有其自己的数据库。</p><h2 id="3-微前端"><a href="#3-微前端" class="headerlink" title="3. 微前端"></a>3. 微前端</h2><p>很多后端开发者轻视前端，认为太简单。</p><p>大多数架构师也是后端出来的，在架构设计中对前端不够重视。</p><p>导致现状就是，后端模块化做的很好，而前端还是一整坨。</p><p>前端单体结构和后端单体有一样的问题，所以前端也需要进行现代化的改造。</p><p>现在的 web 技术简单、强大，例如 web 组件、Angular/React。</p><h2 id="4-持续交付"><a href="#4-持续交付" class="headerlink" title="4. 持续交付"></a>4. 持续交付</h2><p>每个微服务可以独立部署，是微服务架构的核心优势之一。</p><p>比如你的系统包含 100 个微服务，现在有一个需要更新，那么你可以只需要发布这一个，而另外 99 个不需要动。</p><p>这就需要 CI/CD 和 DevOps，如果没有这套自动化流程的话，就像拉着手刹开法拉利。</p><h2 id="5-可观察性"><a href="#5-可观察性" class="headerlink" title="5. 可观察性"></a>5. 可观察性</h2><p>微服务架构简化了开发，但复杂了运维。</p><p>单体结构是非常便于监控的，但在微服务架构中，服务很多，而且通常是跑在容器中，对整个系统的监控就变得非常复杂。</p><p>需要把所有容器、机器中的日志聚合到一起。</p><p>幸运的是已经有成熟的解决方案，例如，使用 <strong>ELK/Splunk</strong> 处理日志，使用 <strong>Prometheus/App Dynamics</strong> 处理监控。</p><p>还有一个比较重要的方面：调用跟踪。</p><p>微服务间会产生级联调用，为了分析系统延迟，就需要测量每个服务的延迟，<strong>Zipkin/Jaeger</strong> 提供了这个能力。</p><h2 id="6-统一技术栈"><a href="#6-统一技术栈" class="headerlink" title="6. 统一技术栈"></a>6. 统一技术栈</h2><p>微服务体系中，不同服务有不同的特性，例如有的服务是 CPU 密集型操作，使用 C++/Rust 比较合适；有的服务是做机器学习的，使用 Python 比较合适。</p><p>所以，可以使用不同的技术处理相应的需求，但是，一定要注意合理性，不要毫无根据的混合使用不同的技术。</p><p>想象一下，在一套系统中，有的微服务使用 Spring Boot + Kotlin+ React + MySQL，有的使用 JakartaEE + Java + Angular + PostgreSQL，有的使用 Scala + Play Framework + VueJS + Oracle。</p><p>这会不会让人很崩溃，太难维护了。</p><h2 id="7-异步通信"><a href="#7-异步通信" class="headerlink" title="7. 异步通信"></a>7. 异步通信</h2><p>服务间的通信问题是微服务架构的重要挑战，比是否共享数据库那个问题还麻烦。</p><p>为了实现业务需求，需要多个微服务的协同工作，服务间需要进行数据交换，一个服务需要触发其他服务。</p><p>最简单的就是通过 REST 接口直接调用，但这种同步调用方式问题比较大。</p><p>例如 A -&gt; B -&gt; C -&gt; D，这种多级调用主要的3个问题：</p><ul><li>增加了系统延迟。</li><li>每个服务可能会故障，这就产生了级联性的错误。</li><li>服务间紧耦合。</li></ul><p>最好是使用异步通信的方式，例如通过消息队列（如 kafka）、异步的 REST（ATOM）、CQRS。</p><h2 id="8-微服务优先"><a href="#8-微服务优先" class="headerlink" title="8. 微服务优先"></a>8. 微服务优先</h2><p>很多人认为新项目应该使用单体结构，这样起步快，比微服务简单，当发展大了之后再改造为微服务。</p><p>然而，这个改造是非常困难的，因为单体中模块的耦合度太高了。</p><p>而且产品成熟后，对在线可用性要求很高，那个时候再改造的话，一定会中断产品运行。</p><h2 id="9-基础设施优于类库"><a href="#9-基础设施优于类库" class="headerlink" title="9. 基础设施优于类库"></a>9. 基础设施优于类库</h2><p>Netflix 早期开发微服务时，主要使用 java 来开发，Netflix 开发出了很多优秀的库，如 <strong>Hystrix, Zuul</strong>，很多公司都使用他们。</p><p>后来，包括 Netflix 在内的很多公司都发现 java 其实并不擅长微服务开发，例如 java 体积过于庞大。</p><p>Netflix 转向了 Polyglot，并停止了之前那些库的维护，这就让很多公司被动了。</p><p>所以，不要过度依赖特定语言的类库，可以使用更底层的基础框架，例如 <strong>Service Meshes</strong>。</p><h2 id="10-组织考虑"><a href="#10-组织考虑" class="headerlink" title="10. 组织考虑"></a>10. 组织考虑</h2><p>50 年前，Melvin Conway 发现公司的软件架构受限于其组织结构。</p><p>其实在现在，这个观点依然正确。</p><p>如果一个组织想使用微服务架构，那么就应该调整好团队的大小。</p><p>两个披萨饼原则：如果两个披萨不足以喂饱一个项目团队，那么这个团队可能就显得太大了。</p><p>而且，团队成员应该是多元化的，有前端、后端、测试、运维。</p><p>只有高层领导者转变思维方式，微服务架构才有可能发挥作用。</p><p>翻译整理自：</p><p><a href="https://towardsdatascience.com/effective-microservices-10-best-practices-c6e4ba0c6ee20">https://towardsdatascience.com/effective-microservices-10-best-practices-c6e4ba0c6ee20</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2019/12/09/hello-world/"/>
    <url>/2019/12/09/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
